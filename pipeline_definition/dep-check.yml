version: 0.2

phases:
  build:
    commands:
    - npm-recursive-install
    - /usr/share/dependency-check/bin/dependency-check.sh --project prm-migrator --scan . --out /report --format ALL
    - cat /report/dependency-check-report.json | jq '.dependencies | .[] | select(.vulnerabilities != null) | {fileName, filePath, vulnerabilities:.vulnerabilities[] | {cvssScore,severity}}'
cache:
  paths:
    - /usr/share/dependency-check/data